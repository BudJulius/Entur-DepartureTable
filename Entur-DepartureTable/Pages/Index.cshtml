@page
@model IndexModel
@{
    ViewData["Title"] = @Model.TimetableModelTrain.data.stopPlace.name;
}
<div class="container d-flex justify-content-center">
    <h1 style="margin-bottom: 2em;">@Model.TimetableModelTrain.data.stopPlace.name</h1>
</div>

<div class="row">
    <div class="col">
        <h3 class="d-flex justify-content-center">Train</h3>
        <table class="table">
            <tbody>
                @foreach(var item in Model.TimetableModelTrain.data.stopPlace.estimatedCalls) {
                    DateTime currentTime = DateTime.Now;
                    DateTime departureTime;

                    <tr>
                        <td>@item.serviceJourney.journeyPattern.line.id.Replace("NSB:Line:", "")  
                                @item.destinationDisplay.frontText</td>
                                
                        @if (DateTime.TryParse(item.expectedDepartureTime.ToString(), out departureTime)) {
                            TimeSpan timeDifference = departureTime - currentTime;
                            if (timeDifference.TotalMinutes <= 15 && timeDifference.TotalMinutes >= 0) {
                                <td style="color:green;">@(timeDifference.Minutes) min</td>
                            }
                            else if (item.expectedDepartureTime != item.aimedDepartureTime) {
                                <td style="color:red;">@item.expectedDepartureTime.ToString("HH:mm")</td>
                            } else {
                                <td>@item.expectedDepartureTime.ToString("HH:mm")</td>
                            }
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="col-sm-1">
    </div>

    <div class="col">
        <h3 class="d-flex justify-content-center">Bus</h3>
        <table class="table">
            <tbody>
                @foreach(var item in Model.TimetableModelBus.data.stopPlace.estimatedCalls) {
                    DateTime currentTime = DateTime.Now;
                    DateTime departureTime;

                    <tr>
                        <td>@item.serviceJourney.journeyPattern.line.id.Replace("RUT:Line:", "")  
                                @item.destinationDisplay.frontText</td>

                        @if (DateTime.TryParse(item.expectedDepartureTime.ToString(), out departureTime)) {
                            TimeSpan timeDifference = departureTime - currentTime;
                            if (timeDifference.TotalMinutes <= 15 && timeDifference.TotalMinutes >= 0) {
                                <td style="color:green;">@(timeDifference.Minutes) min</td>
                            }
                            else if (item.expectedDepartureTime != item.aimedDepartureTime) {
                                <td style="color:red;">@item.expectedDepartureTime.ToString("HH:mm")</td>
                            } else {
                                <td>@item.expectedDepartureTime.ToString("HH:mm")</td>
                            }
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>